(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[165],{6269:(e,s,a)=>{Promise.resolve().then(a.bind(a,6268))},6268:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>i});var l=a(5155),t=a(2115),n=a(8173),m=a.n(n);function i(){let[e,s]=(0,t.useState)([]),[a,n]=(0,t.useState)(!1),[i,r]=(0,t.useState)(0),[d,c]=(0,t.useState)([]),[o,h]=(0,t.useState)(""),[x,u]=(0,t.useState)(!0),[p,b]=(0,t.useState)(""),[j,N]=(0,t.useState)("default"),[f,g]=(0,t.useState)({emailUser:"",emailPassword:"",smtpHost:"smtp.gmail.com",smtpPort:"587",fromName:""});(0,t.useEffect)(()=>{let e=localStorage.getItem("traineesData");if(e)try{let a=JSON.parse(e);s(a)}catch(e){console.error("Error parsing stored data:",e),h("حدث خطأ في استرجاع بيانات المتدربين")}else h("لم يتم العثور على بيانات المتدربين. يرجى رفع ملف البيانات أولاً.")},[]);let v=e=>{let{name:s,value:a}=e.target;g(e=>({...e,[s]:a}))},y=e=>{u("test"===e.target.value)},w=e=>{if("default"===j);else if("male"===j)return"مرحباً،\n\nنرجو أن تجد مرفقاً شهادتك لإتمام البرنامج التدريبي.\n\nشكراً لمشاركتك معنا، ونتمنى لك التوفيق في مسيرتك المهنية.\n\nمع أطيب التحيات،\nفريق التدريب";else if("female"===j)return"مرحباً،\n\nنرجو أن تجدي مرفقاً شهادتك لإتمام البرنامج التدريبي.\n\nشكراً لمشاركتك معنا، ونتمنى لك التوفيق في مسيرتك المهنية.\n\nمع أطيب التحيات،\nفريق التدريب";return"مرحباً،\n\nنرجو أن تجد مرفقاً شهادة إتمام البرنامج التدريبي.\n\nشكراً لمشاركتك معنا.\n\nمع أطيب التحيات،\nفريق التدريب"},k=()=>f.emailUser&&f.emailPassword&&f.smtpHost&&f.smtpPort?!x||!!p||(h("يرجى إدخال بريد إلكتروني للاختبار"),!1):(h("يرجى إدخال جميع بيانات SMTP المطلوبة"),!1),S=async()=>{if(0===e.length){h("لا توجد بيانات متدربين لإرسال الشهادات");return}if(k()){n(!0),h(""),r(0),c([]);try{let a=x?[{email:p,trainee_name:"اختبار",Gender:"Male",id:0}]:e.map((e,s)=>({email:e.email,trainee_name:e.trainee_name,Gender:e.Gender,id:s})),l=a.length,t=[];for(let n=0;n<l;n++){let m=a[n];w(m.Gender),await new Promise(e=>setTimeout(e,1e3));let i=Math.random()>.2;if(t.push({email:m.email,status:i?"sent":"failed",message:i?"تم الإرسال بنجاح":"فشل في الإرسال"}),!x){let a=[...e];a[m.id]={...e[m.id],status:i?"sent":"failed"},s(a)}r(Math.round((n+1)/l*100)),c(t)}x||localStorage.setItem("traineesData",JSON.stringify(e))}catch(e){console.error("Error sending emails:",e),h("حدث خطأ أثناء إرسال البريد الإلكتروني: ".concat(e.message))}finally{n(!1)}}};return(0,l.jsxs)("main",{className:"container mx-auto px-4 py-8",children:[(0,l.jsxs)("header",{className:"mb-8",children:[(0,l.jsx)(m(),{href:"/generate",className:"text-primary hover:underline mb-4 inline-block",children:"← العودة إلى صفحة إنشاء الشهادات"}),(0,l.jsx)("h1",{className:"text-3xl font-bold",children:"إرسال الشهادات بالبريد الإلكتروني"})]}),o&&(0,l.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:o}),(0,l.jsxs)("div",{className:"grid md:grid-cols-2 gap-8",children:[(0,l.jsxs)("div",{className:"card",children:[(0,l.jsx)("h2",{className:"text-xl font-bold mb-4",children:"إعدادات البريد الإلكتروني (SMTP)"}),(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"عنوان البريد الإلكتروني"}),(0,l.jsx)("input",{type:"email",name:"emailUser",value:f.emailUser,onChange:v,className:"input-field",placeholder:"example@gmail.com"})]}),(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"كلمة المرور أو كلمة مرور التطبيق"}),(0,l.jsx)("input",{type:"password",name:"emailPassword",value:f.emailPassword,onChange:v,className:"input-field",placeholder:"••••••••"}),(0,l.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"ملاحظة: لحسابات Gmail، يجب استخدام كلمة مرور التطبيق وليس كلمة مرور الحساب العادية."})]}),(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"خادم SMTP"}),(0,l.jsx)("input",{type:"text",name:"smtpHost",value:f.smtpHost,onChange:v,className:"input-field",placeholder:"smtp.gmail.com"})]}),(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"منفذ SMTP"}),(0,l.jsx)("input",{type:"text",name:"smtpPort",value:f.smtpPort,onChange:v,className:"input-field",placeholder:"587"})]}),(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"اسم المرسل"}),(0,l.jsx)("input",{type:"text",name:"fromName",value:f.fromName,onChange:v,className:"input-field",placeholder:"اسم المرسل"})]}),(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"نوع قالب البريد الإلكتروني"}),(0,l.jsxs)("select",{className:"input-field",value:j,onChange:e=>{N(e.target.value)},children:[(0,l.jsx)("option",{value:"default",children:"قالب للجنسين"}),(0,l.jsx)("option",{value:"male",children:"قالب للذكور"}),(0,l.jsx)("option",{value:"female",children:"قالب للإناث"})]}),(0,l.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"سيتم استخدام القالب المناسب تلقائياً حسب جنس المتدرب."})]}),(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-2",children:"وضع الإرسال"}),(0,l.jsxs)("div",{className:"flex items-center mb-2",children:[(0,l.jsx)("input",{type:"radio",id:"test-mode",name:"send-mode",value:"test",checked:x,onChange:y,className:"mr-2"}),(0,l.jsx)("label",{htmlFor:"test-mode",children:"وضع الاختبار (إرسال إلى بريد إلكتروني واحد للتجربة)"})]}),(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("input",{type:"radio",id:"all-mode",name:"send-mode",value:"all",checked:!x,onChange:y,className:"mr-2"}),(0,l.jsx)("label",{htmlFor:"all-mode",children:"إرسال إلى جميع المتدربين"})]})]}),x&&(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"البريد الإلكتروني للاختبار"}),(0,l.jsx)("input",{type:"email",value:p,onChange:e=>{b(e.target.value)},className:"input-field",placeholder:"test@example.com"})]}),(0,l.jsx)("button",{onClick:S,disabled:a||0===e.length||!f.emailUser||!f.emailPassword,className:"btn-primary w-full ".concat(!a&&0!==e.length&&f.emailUser&&f.emailPassword?"":"opacity-50 cursor-not-allowed"),children:a?"جاري الإرسال...":x?"إرسال بريد اختباري":"إرسال الشهادات بالبريد الإلكتروني"})]}),(0,l.jsxs)("div",{className:"card",children:[(0,l.jsx)("h2",{className:"text-xl font-bold mb-4",children:"بيانات المتدربين"}),(0,l.jsxs)("p",{className:"mb-4",children:["عدد المتدربين: ",(0,l.jsx)("span",{className:"font-bold",children:e.length})]}),a&&(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsxs)("p",{className:"mb-2",children:["جاري إرسال البريد الإلكتروني: ",i,"%"]}),(0,l.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:(0,l.jsx)("div",{className:"bg-primary h-2.5 rounded-full",style:{width:"".concat(i,"%")}})})]}),d.length>0&&!x&&(0,l.jsx)("button",{onClick:()=>{if(e.length>0){let s=new Blob([[Object.keys(e[0]).join(","),...e.map(e=>Object.values(e).map(e=>"string"==typeof e?'"'.concat(e.replace(/"/g,'""'),'"'):e).join(","))].join("\n")],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(s),l=document.createElement("a");l.href=a,l.setAttribute("download","trainees_data_with_status.csv"),document.body.appendChild(l),l.click(),document.body.removeChild(l)}},className:"btn-primary w-full mb-4",children:"تنزيل البيانات المحدثة مع حالة الإرسال"}),(0,l.jsxs)("div",{className:"mt-4",children:[(0,l.jsx)("h3",{className:"text-lg font-bold mb-2",children:"معاينة قالب البريد الإلكتروني"}),(0,l.jsx)("div",{className:"bg-gray-50 p-4 rounded border",children:(0,l.jsx)("pre",{className:"whitespace-pre-wrap text-sm",children:w("female"===j?"Female":"Male")})})]})]})]}),d.length>0&&(0,l.jsxs)("div",{className:"card mt-8",children:[(0,l.jsx)("h2",{className:"text-xl font-bold mb-4",children:"نتائج الإرسال"}),(0,l.jsx)("div",{className:"overflow-x-auto",children:(0,l.jsxs)("table",{className:"table w-full",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{children:"البريد الإلكتروني"}),(0,l.jsx)("th",{children:"الحالة"}),(0,l.jsx)("th",{children:"الرسالة"})]})}),(0,l.jsx)("tbody",{children:d.map((e,s)=>(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{children:e.email}),(0,l.jsx)("td",{children:(0,l.jsx)("span",{className:"sent"===e.status?"status-sent":"status-failed",children:"sent"===e.status?"تم الإرسال":"فشل"})}),(0,l.jsx)("td",{children:e.message})]},s))})]})})]})]})}}},e=>{var s=s=>e(e.s=s);e.O(0,[173,441,517,358],()=>s(6269)),_N_E=e.O()}]);