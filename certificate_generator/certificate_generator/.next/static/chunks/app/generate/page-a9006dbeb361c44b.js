(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[456],{7332:(e,l,a)=>{Promise.resolve().then(a.bind(a,4562))},6046:(e,l,a)=>{"use strict";var t=a(6658);a.o(t,"useRouter")&&a.d(l,{useRouter:function(){return t.useRouter}})},4562:(e,l,a)=>{"use strict";a.r(l),a.d(l,{default:()=>d});var t=a(5155),s=a(2115),r=a(8173),n=a.n(r),i=a(6046);function c(e){let{certificate:l,onDownload:a,onSendEmail:r}=e,n=()=>{if(!l)return"";let e=new Blob([l.pdfBytes],{type:"application/pdf"});return URL.createObjectURL(e)};return(s.useEffect(()=>{let e=n();return()=>{e&&URL.revokeObjectURL(e)}},[l]),l)?(0,t.jsxs)("div",{className:"card",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsx)("h2",{className:"text-xl font-bold",children:"معاينة الشهادة"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:a,className:"btn-primary",children:"تنزيل الشهادة"}),(0,t.jsx)("button",{onClick:r,className:"btn-secondary",children:"إرسال بالبريد الإلكتروني"})]})]}),(0,t.jsxs)("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:[(0,t.jsx)("h3",{className:"font-bold mb-2",children:"تفاصيل الشهادة:"}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"الاسم:"})," ",l.trainee.trainee_name]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"البريد الإلكتروني:"})," ",l.trainee.email]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"البرنامج التدريبي:"})," ",l.trainee.trainee_program]})]}),(0,t.jsx)("div",{className:"border rounded-lg overflow-hidden",style:{height:"600px"},children:(0,t.jsx)("iframe",{src:n(),width:"100%",height:"100%",style:{border:"none"},title:"معاينة الشهادة"})})]}):(0,t.jsx)("div",{className:"card flex items-center justify-center min-h-[500px]",children:(0,t.jsx)("div",{className:"text-center",children:(0,t.jsx)("p",{className:"text-gray-600",children:"لم يتم اختيار أي شهادة للمعاينة"})})})}function d(){let e=(0,i.useRouter)(),[l,r]=(0,s.useState)(!1),[d,o]=(0,s.useState)([]),[m,h]=(0,s.useState)([]),[x,u]=(0,s.useState)(null),[b,f]=(0,s.useState)(""),[p,j]=(0,s.useState)(null),[v,N]=(0,s.useState)("/template.pdf"),[g,y]=(0,s.useState)(""),[w,k]=(0,s.useState)("2025"),[U,R]=(0,s.useState)(!1);(0,s.useEffect)(()=>{let e=localStorage.getItem("traineesData");if(e)try{let l=JSON.parse(e);o(l)}catch(e){console.error("Error parsing stored data:",e),f("حدث خطأ في استرجاع بيانات المتدربين")}else f("لم يتم العثور على بيانات المتدربين. يرجى رفع ملف البيانات أولاً.")},[]);let _=async()=>{if(0===d.length){f("لا توجد بيانات متدربين لإنشاء الشهادات");return}r(!0),f("");try{let{PDFDocument:e,rgb:l}=await a.e(71).then(a.bind(a,71)),t=await Promise.all([a.e(247),a.e(138)]).then(a.bind(a,3479)),s=[];for(let a=0;a<d.length;a++){let r=d[a];try{let n=await fetch(v).then(e=>e.arrayBuffer()),i=await e.load(n);i.registerFontkit(t);let c=await fetch("/fonts/shamel_bold.ttf").then(e=>e.arrayBuffer()),d=await fetch("/fonts/shamel_light.ttf").then(e=>e.arrayBuffer()),o=await i.embedFont(c);await i.embedFont(d);let m=i.getPages()[0],{width:h,height:x}=m.getSize(),u=(e,l,a)=>{let t=l.widthOfTextAtSize(e,a);return(h-t)/2};m.drawText(r.trainee_name,{x:u(r.trainee_name,o,30),y:x-350,size:30,font:o,color:l(.62,.45,.78)});let b=r.trainee_program;b=b.replace(/\)XU\/IU\(/g,"(UX/UI)"),m.drawText(b,{x:u(b,o,30),y:x-510,size:30,font:o,color:l(.77,.67,.86)}),U&&(g&&m.drawText(g,{x:h-100,y:x-100,size:20,font:o,color:l(.3,.3,.3)}),w&&m.drawText(w,{x:80,y:x-100,size:20,font:o,color:l(.3,.3,.3)}));let f=await i.save();s.push({id:a+1,trainee:r,pdfBytes:f})}catch(e){console.error("Error generating certificate for ".concat(r.trainee_name,":"),e)}}h(s),s.length>0&&u(s[0].id)}catch(e){console.error("Error generating certificates:",e),f("حدث خطأ أثناء إنشاء الشهادات: ".concat(e.message))}finally{r(!1)}};return(0,t.jsxs)("main",{className:"container mx-auto px-4 py-8",children:[(0,t.jsxs)("header",{className:"mb-8",children:[(0,t.jsx)(n(),{href:"/upload",className:"text-primary hover:underline mb-4 inline-block",children:"← العودة إلى صفحة رفع الملفات"}),(0,t.jsx)("h1",{className:"text-3xl font-bold",children:"إنشاء الشهادات"})]}),b&&(0,t.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:b}),(0,t.jsxs)("div",{className:"grid md:grid-cols-3 gap-8",children:[(0,t.jsxs)("div",{className:"md:col-span-1",children:[(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("h2",{className:"text-xl font-bold mb-4",children:"الإعدادات"}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"قالب الشهادة"}),(0,t.jsxs)("div",{className:"flex items-center mb-2",children:[(0,t.jsx)("button",{onClick:()=>{j(null),N("/template.pdf"),h([]),u(null)},className:"btn-secondary text-sm mr-2",disabled:!p,children:"استخدام القالب الافتراضي"}),p&&(0,t.jsxs)("span",{className:"text-sm text-green-600",children:["تم رفع: ",p.name]})]}),(0,t.jsx)("input",{type:"file",accept:".pdf",onChange:e=>{var l;let a=null===(l=e.target.files)||void 0===l?void 0:l[0];if(a){if("application/pdf"!==a.type){f("يرجى رفع ملف PDF فقط");return}j(a),N(URL.createObjectURL(a)),h([]),u(null)}},className:"block w-full text-gray-700 bg-white rounded-lg border border-gray-300 cursor-pointer focus:outline-none p-2"})]}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsxs)("div",{className:"flex items-center mb-2",children:[(0,t.jsx)("input",{type:"checkbox",id:"show-date-fields",checked:U,onChange:()=>{R(!U),U||(h([]),u(null))},className:"mr-2"}),(0,t.jsx)("label",{htmlFor:"show-date-fields",className:"text-sm font-medium",children:"إضافة حقول التاريخ (اختياري)"})]}),U&&(0,t.jsxs)("div",{className:"mt-2 bg-gray-50 p-3 rounded",children:[(0,t.jsxs)("div",{className:"mb-2",children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"الشهر (يظهر في أعلى اليمين)"}),(0,t.jsx)("select",{className:"input-field",value:g,onChange:e=>{y(e.target.value),h([]),u(null)},children:[{value:"",label:"بدون شهر"},{value:"JAN",label:"JAN - يناير"},{value:"FEB",label:"FEB - فبراير"},{value:"MAR",label:"MAR - مارس"},{value:"APR",label:"APR - أبريل"},{value:"MAY",label:"MAY - مايو"},{value:"JUN",label:"JUN - يونيو"},{value:"JUL",label:"JUL - يوليو"},{value:"AUG",label:"AUG - أغسطس"},{value:"SEP",label:"SEP - سبتمبر"},{value:"OCT",label:"OCT - أكتوبر"},{value:"NOV",label:"NOV - نوفمبر"},{value:"DEC",label:"DEC - ديسمبر"}].map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,t.jsxs)("div",{className:"mb-2",children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"السنة (تظهر في أعلى اليسار)"}),(0,t.jsx)("select",{className:"input-field",value:w,onChange:e=>{k(e.target.value),h([]),u(null)},children:[{value:"",label:"بدون سنة"},{value:"2025",label:"2025"},{value:"2026",label:"2026"},{value:"2027",label:"2027"},{value:"2028",label:"2028"}].map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))})]})]})]}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"الخط"}),(0,t.jsxs)("select",{className:"input-field",children:[(0,t.jsx)("option",{children:"شامل بولد"}),(0,t.jsx)("option",{children:"شامل لايت"})]})]}),(0,t.jsx)("button",{onClick:_,disabled:l||0===d.length,className:"btn-primary w-full ".concat(l||0===d.length?"opacity-50 cursor-not-allowed":""),children:l?"جاري الإنشاء...":"إنشاء الشهادات"})]}),m.length>0&&(0,t.jsxs)("div",{className:"card mt-4",children:[(0,t.jsxs)("h2",{className:"text-xl font-bold mb-4",children:["قائمة الشهادات (",m.length,")"]}),(0,t.jsx)("div",{className:"max-h-80 overflow-y-auto",children:(0,t.jsx)("ul",{className:"divide-y",children:m.map(e=>(0,t.jsxs)("li",{className:"py-2 px-2 cursor-pointer hover:bg-gray-50 ".concat(x===e.id?"bg-primary-light bg-opacity-20 rounded":""),onClick:()=>u(e.id),children:[(0,t.jsx)("p",{className:"font-bold",children:e.trainee.trainee_name}),(0,t.jsx)("p",{className:"text-sm text-gray-600",children:e.trainee.email})]},e.id))})})]})]}),(0,t.jsxs)("div",{className:"md:col-span-2",children:[l?(0,t.jsx)("div",{className:"card flex items-center justify-center min-h-[500px]",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary mb-4"}),(0,t.jsx)("p",{className:"text-gray-600",children:"جاري إنشاء الشهادات..."})]})}):(0,t.jsx)(c,{certificate:x&&m.find(e=>e.id===x)||null,onDownload:()=>{if(x){let e=m.find(e=>e.id===x);if(e){let l=new Blob([e.pdfBytes],{type:"application/pdf"}),a=URL.createObjectURL(l),t=document.createElement("a");t.href=a,t.download="".concat(e.trainee.trainee_name.replace(/\s+/g,"_"),".pdf"),t.click(),URL.revokeObjectURL(a)}}},onSendEmail:()=>{e.push("/send")}}),m.length>0&&(0,t.jsxs)("div",{className:"card mt-4",children:[(0,t.jsx)("h2",{className:"text-xl font-bold mb-4",children:"إجراءات جماعية"}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-4",children:[(0,t.jsx)("button",{onClick:()=>{if(m.length>0)for(let e of m){let l=new Blob([e.pdfBytes],{type:"application/pdf"}),a=URL.createObjectURL(l),t=document.createElement("a");t.href=a,t.download="".concat(e.trainee.trainee_name.replace(/\s+/g,"_"),".pdf"),t.click(),URL.revokeObjectURL(a),setTimeout(()=>{},500)}},className:"btn-primary",children:"تنزيل جميع الشهادات"}),(0,t.jsx)(n(),{href:"/send",className:"btn-primary",children:"إرسال جميع الشهادات بالبريد الإلكتروني"})]})]})]})]})]})}}},e=>{var l=l=>e(e.s=l);e.O(0,[173,441,517,358],()=>l(7332)),_N_E=e.O()}]);